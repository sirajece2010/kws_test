<!doctype html>
<script>
(function () {
  const applyTheme = (theme) => {
    const root = document.documentElement;
    root.classList.remove('theme-dark', 'theme-light');
    root.classList.add(theme === 'dark' ? 'theme-dark' : 'theme-light');
    try { localStorage.setItem('theme', theme); } catch (e) {}
    const btn = document.getElementById('theme-toggle');
    if (btn) {
      const isDark = theme === 'dark';
      btn.setAttribute('aria-pressed', String(isDark));
      btn.textContent = isDark ? 'Light Mode' : 'Dark Mode';
      btn.title = isDark ? 'Switch to light theme' : 'Switch to dark theme';
      refresh();
    }
  };

  const init = () => {
    if (!document.getElementById('theme-style')) {
      const style = document.createElement('style');
      style.id = 'theme-style';
      style.textContent = `
:root.theme-light {
  --bg: #ffffff;
  --fg: #111111;
  --muted: #555555;
  --border: #dddddd;
  --th-bg: #f2f2f2;
  --th-fg: #111111;
  --available-bg: #e6ffed;
  --available-fg: #0a7a2f;
  --available-border: #a8e6b0;
  --allocated-bg: #fff4e5;
  --allocated-fg: #8a4b0f;
  --allocated-border: #f3cf9e;
  --error: #c62828;
  --success: #2e7d32;
}
:root.theme-dark {
  --bg: #0b0f14;
  --fg: #f1f5f9;
  --muted: #b6c0cc;
  --border: #3a4351;
  --th-bg: #1a2433;
  --th-fg: #f1f5f9;
  --available-bg: #0f2e1d;
  --available-fg: #a5efc6;
  --available-border: #2e5f42;
  --allocated-bg: #2a1e12;
  --allocated-fg: #ffd28a;
  --allocated-border: #5a4126;
  --error: #ff6b6b;
  --success: #7bd88f;
}
body { background: var(--bg); color: var(--fg); }
.muted { color: var(--muted); }
th { background: var(--th-bg) !important; color: var(--th-fg) !important; }
td, th { border-color: var(--border) !important; }
.available { background: var(--available-bg) !important; color: var(--available-fg) !important; border-color: var(--available-border) !important; }
.allocated { background: var(--allocated-bg) !important; color: var(--allocated-fg) !important; border-color: var(--allocated-border) !important; }
.error { color: var(--error) !important; }
.success { color: var(--success) !important; }
input, button, select { background: var(--th-bg); color: var(--th-fg); border: 1px solid var(--border); }
#theme-toggle { margin-left: auto; }
      `;
      document.head.appendChild(style);
    }

    const container = document.querySelector('.controls');
    if (container && !document.getElementById('theme-toggle')) {
      const btn = document.createElement('button');
      btn.id = 'theme-toggle';
      btn.type = 'button';
      btn.textContent = 'Dark Mode';
      btn.setAttribute('aria-pressed', 'false');
      btn.title = 'Switch to dark theme';
      btn.addEventListener('click', () => {
        const isDark = document.documentElement.classList.contains('theme-dark');
        applyTheme(isDark ? 'light' : 'dark');
      });
      container.appendChild(btn);
    }

    window.addEventListener('keydown', (e) => {
      if ((e.altKey || e.metaKey) && (e.key === 't' || e.key === 'T')) {
        e.preventDefault();
        const isDark = document.documentElement.classList.contains('theme-dark');
        applyTheme(isDark ? 'light' : 'dark');
      }
    });

    let theme;
    try { theme = localStorage.getItem('theme'); } catch (e) {}
    if (theme !== 'dark' && theme !== 'light') {
      theme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }
    applyTheme(theme);
  };

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Open Inventory</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    :root { font-family: system-ui, sans-serif; }
    body { max-width: 1000px auto; margin: 32px auto; padding: 0 8px; }
    h1 { margin-bottom: 8px; }
    .controls { display: flex; gap: 12px; align-items: center; margin-bottom: 16px; flex-wrap: wrap; }
    input, button { padding: 8px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background: #c68e8e; }
    .badge { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 12px; }
    .available { background: #e6ffed; color: #0a7a2f; border: 1px solid #a8e6b0; }
    .allocated { background: #fff4e5; color: #8a4b0f; border: 1px solid #f3cf9e; }
    .actions { display: flex; gap: 6px; }
    .error { color: #c62828; margin-top: 8px; }
    .success { color: #2e7d32; margin-top: 8px; }
    .muted { color: #555; font-size: 12px; }
  </style>
</head>
<body>
  <h1>Open Options</h1>

  <div class="controls">
    <input id="search" type="text" placeholder="Search by name or serial" />
    <form id="create-form" onsubmit="return false;">
      <input id="new-name" type="text" placeholder="Symbol name" required />
      <input id="new-serial" type="text" placeholder="Token (unique)" required />
      <input id="new-strike" type="text" placeholder="Strike" required />
      <input id="new-quantity" type="text" placeholder="Quantity" required />
      <button id="create-btn">Add Symbol</button>
      <button id="auth-btn">Authenticate</button>
      <select id="portfolio-select" required>
        <option value="">Select Portfolio</option>
      </select>
      <button id="get-portfolio-btn">Get Portfolio</button>
    </form>
    <span id="status" class="muted"></span>
  </div>

  <table>
    <thead>
      <tr>
        <th>S.No</th>
        <th>Symbol</th>
        <th>Inst_Token</th>
        <th>Type</th>
        <th>Status</th>
        <th>Strike</th>
        <th>Quantity</th>
        <th>Avg Price</th>
        <th>LTP</th>
        <th>Booked P&L</th>
        <th>Unbooked P&L</th>
        <th>Stop Loss</th>
        <th>Total P&L</th>
        <th>Expires_on</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <!-- Put script here, not inside the table -->
  <script src="/app.js"></script>
</body>
</html>
